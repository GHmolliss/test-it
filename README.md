# Каталог книг на Yii1 + MySQL

Веб-приложение для управления каталогом книг с поддержкой авторов, подписок и SMS-уведомлений.

## Требования

- PHP 8.0+
- MySQL 8.0 / MariaDB 10.5+
- Docker и Docker Compose (для локального развёртывания)

## Функциональность

### Основной функционал

1. **Каталог книг**
   - Просмотр полного списка книг (доступно всем)
   - Просмотр деталей книги с информацией об авторах
   - Книга содержит: название, год выпуска, описание, ISBN, фото
   - CRUD операции для авторизованных пользователей

2. **Управление авторами**
   - Просмотр профилей авторов (доступно всем)
   - Просмотр книг каждого автора
   - CRUD операции для авторизованных пользователей

3. **Система подписок**
   - Гости могут подписаться на уведомления о новых книгах автора
   - Автоматическая отправка SMS-уведомлений при добавлении новой книги автора

4. **Отчёты**
   - ТОП 10 авторов, выпустивших больше всего книг за выбранный год
   - Доступен всем пользователям (гостям и авторизованным)

5. **SMS-уведомления (плюс)**
   - Интеграция с SMS Pilot для отправки SMS
   - Очередь уведомлений в БД
   - Консольная команда для обработки очереди

### Права доступа

| Функция | Гость | Авторизованный |
|---------|-------|-----------------|
| Просмотр книг и авторов | ✓ | ✓ |
| Подписка на автора | ✓ | ✓ |
| Добавление/редактирование/удаление книг | ✗ | ✓ |
| Добавление/редактирование/удаления авторов | ✗ | ✓ |
| Просмотр отчётов | ✓ | ✓ |

## Быстрый старт

### 1. Клонирование и подготовка

```bash
git clone <repository>
cd test-it
```

### 2. Запуск контейнеров Docker

```bash
docker compose up -d
```

Контейнеры запустятся:
- **nginx**: http://localhost
- **php**: PHP-FPM 8.x
- **MySQL**: localhost:3307
- **PhpMyAdmin**: http://localhost:8080

### 3. Установка зависимостей Composer

```bash
docker compose exec php composer install
```

### 4. Выполнение миграций БД

```bash
docker compose exec php php /var/www/html/yiic migrate
```

Будут созданы таблицы:
- `session` - сессии пользователей
- `auth_item`, `auth_item_child`, `auth_assignment` - RBAC таблицы
- `user` - пользователи системы
- `author` - авторы книг
- `book` - книги
- `book_author` - связь книг и авторов (many-to-many)
- `subscription` - подписки на авторов
- `notification_queue` - очередь SMS-уведомлений

### 5. Конфигурация SMS

Откройте [app/src/Config/main.php](app/src/Config/main.php) и установите API ключ SMS Pilot:

```php
'params' => [
    'smsPilotApiKey' => 'ваш-api-ключ-sms-pilot',
    'uploadPath' => 'uploads/books/',
],
```

Для тестирования используйте ключ-эмулятор: `XXXXXXXXXXXXYYYYYYYYYYYYZZZZZZZZXXXXXXXXXXXXYYYYYYYYYYYYZZZZZZZZ`
